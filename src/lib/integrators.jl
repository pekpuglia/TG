function euler(f, X, dt)
    X + f(X)*dt
end

function RK4(f, X, dt)
    k1 = dt*f(X)
    k2 = dt*f(X+k1/2)
    k3 = dt*f(X+k2/2)
    k4 = dt*f(X+k3)
    X + (k1+2k2+2k3+k4)/6
end

#doesn't work with JuMP
function RK8(f, X, dt)
    #time invariant dynamics
    # c = zeros(Float64, (16,))
    # c[1] =  0
    # c[2] =  .4e-1
    # c[3] =  .9648736013787361245235039379666356743708e-1
    # c[4] =  .1447310402068104186785255906949953511556
    # c[5] =  .576
    # c[6] =  .2272326564618766017153738192188229509142
    # c[7] =  .5407673435381233982846261807811770490858
    # c[8] =  .64
    # c[9] =  .48
    # c[10] =  .6754e-1
    # c[11] =  .25
    # c[12] =  .6770920153543242682384311058159603931192
    # c[13] =  .8115
    # c[14] =  .906
    # c[15] =  1
    # c[16] =  1

    a = zeros(Float64, (16,16))
    a[2,1] =  .4e-1

    a[3,1] = -.198852731918229097650241511466089129345e-1
    a[3,2] =  .1163726333296965222173745449432724803716

    a[4,1] =  .3618276005170260466963139767374883778890e-1
    a[4,2] =  0
    a[4,3] =  .1085482801551078140088941930212465133667

    a[5,1] =  2.272114264290177409193144938921415409241
    a[5,2] =  0
    a[5,3] = -8.526886447976398578316416192982602292786
    a[5,4] =  6.830772183686221169123271254061186883545

    a[6,1] =  .5094385535389374394512668566783434123978e-1
    a[6,2] =  0
    a[6,3] =  0
    a[6,4] =  .1755865049809071110203693328749561646990
    a[6,5] =  .70229612707574674987780067603244497535e-3

    a[7,1] =  .1424783668683284782770955365543878809824
    a[7,2] =  0
    a[7,3] =  0
    a[7,4] = -.3541799434668684104094753917518523845155
    a[7,5] =  .7595315450295100889001534202778550159932e-1
    a[7,6] =  .6765157656337123215269906939508560510196

    a[8,1] =  .7111111111111111111111111111111111111111e-1
    a[8,2] =  0
    a[8,3] =  0
    a[8,4] =  0
    a[8,5] =  0
    a[8,6] =  .3279909287605898328568406057725491803016
    a[8,7] =  .2408979601282990560320482831163397085872

    a[9,1] =  .7125e-1
    a[9,2] =  0
    a[9,3] =  0
    a[9,4] =  0
    a[9,5] =  0
    a[9,6] =  .3268842451575245554847578757216915662785
    a[9,7] =  .1156157548424754445152421242783084337215
    a[9,8] = -.3375e-1

    a[10,1] =  .4822677322465810178387112087673611111111e-1
    a[10,2] =  0
    a[10,3] =  0
    a[10,4] =  0
    a[10,5] =  0
    a[10,6] =  .3948559980495400110769549704186108167677e-1
    a[10,7] =  .1058851161934658144373823566907778072121
    a[10,8] = -.2152006320474309346664428710937500000000e-1
    a[10,9] = -.1045374260183348238623046875000000000000

    a[11,1] = -.2609113435754923412210928689962011065179e-1
    a[11,2] =  0
    a[11,3] =  0
    a[11,4] =  0
    a[11,5] =  0
    a[11,6] =  .3333333333333333333333333333333333333333e-1
    a[11,7] = -.1652504006638105086724681598195267241410
    a[11,8] =  .3434664118368616658319419895678838776647e-1
    a[11,9] =  .1595758283215209043195814910843067811951
    a[11,10] =  .2140857321828193385584684233447183324979

    a[12,1] = -.362842339625565859076509979091267105528e-1
    a[12,2] =  0
    a[12,3] =  0
    a[12,4] =  0
    a[12,5] =  0
    a[12,6] = -1.096167597427208807028761474420297770752
    a[12,7] =  .1826035504321331052308236240517254331348
    a[12,8] =  .708225444417068325613028685455625123741e-1
    a[12,9] = -.231364701848243126999929738482630407146e-1
    a[12,10] =  .2711204726320932916455631550463654973432
    a[12,11] =  1.308133749422980744437146904349994472286

    a[13,1] = -.5074635056416974879347823927726392374259
    a[13,2] =  0
    a[13,3] =  0
    a[13,4] =  0
    a[13,5] =  0
    a[13,6] = -6.631342198657237090355284142048733580937
    a[13,7] = -.252748010090880105270020973014860316405
    a[13,8] = -.4952612380036095562991116175550167835424
    a[13,9] =  .293252554525388690285739720360003594753
    a[13,10] =  1.440108693768280908474851998204423941413
    a[13,11] =  6.237934498647055877243623886838802127716
    a[13,12] =  .7270192054526987638549835199880202544289

    a[14,1] =  .6130118256955931701496387847232542148725
    a[14,2] =  0
    a[14,3] =  0
    a[14,4] =  0
    a[14,5] =  0
    a[14,6] =  9.088803891640463313341034206647776279557
    a[14,7] = -.407378815629344868103315381138325162923
    a[14,8] =  1.790733389490374687043894756399015035977
    a[14,9] =  .714927166761755073724875250629602731782
    a[14,10] = -1.438580857841722850237810322456327208949
    a[14,11] = -8.263329312064740580595954649844133476994
    a[14,12] = -1.537570570808865115231450725068826856201
    a[14,13] =  .3453832827564871699090880801079644428793

    a[15,1] = -1.211697910343873872490625222495537087293
    a[15,2] =  0
    a[15,3] =  0
    a[15,4] =  0
    a[15,5] =  0
    a[15,6] = -19.05581871559595277753334676575234493500
    a[15,7] =  1.26306067538987510135943101851905310045
    a[15,8] = -6.913916969178458046793476128409110926069
    a[15,9] = -.676462266509498065300115641383621209887
    a[15,10] =  3.367860445026607887090352785684064242560
    a[15,11] =  18.00675164312590810020103216906571965203
    a[15,12] =  6.838828926794279896350389904990814350968
    a[15,13] = -1.031516451921950498420447675652291096155
    a[15,14] =  .4129106232130622755368055554332539084021

    a[16,1] =  2.157389007494053627033175177985666660692
    a[16,2] =  0
    a[16,3] =  0
    a[16,4] =  0
    a[16,5] =  0
    a[16,6] =  23.80712219809580523172312179815279712750
    a[16,7] =  .88627792492165554903036801415266308369
    a[16,8] =  13.13913039759876381480201677314222971522
    a[16,9] = -2.604415709287714883747369630937415176632
    a[16,10] = -5.193859949783872300189266203049579105962
    a[16,11] = -20.41234071154150778768154893536134356354
    a[16,12] = -12.30085625250572261314889445241581039623
    a[16,13] =  1.521553095008539362178397458330791655267
    a[16,14] =  0
    a[16,15] =  0

    b = zeros(Float64, (16,))
    b[1] =  .1458885278405539719101539582255752917034e-1
    b[2] =  0
    b[3] =  0
    b[4] =  0
    b[5] =  0
    b[6] =  0
    b[7] =  0
    b[8] =  .2024197887889332650566666683195656097825e-2
    b[9] =  .2178047084569716646796256135839225745895
    b[10] =  .1274895340854389692868677968654808668201
    b[11] =  .2244617745463131861258531547137348031621
    b[12] =  .1787254491259903095100090833796054447157
    b[13] =  .7594344758096557172908303416513173076283e-1
    b[14] =  .1294845879197561516869001434704642286297
    b[15] =  .2947744761261941714007911131590716605202e-1
    b[16] =  0

    F = [zeros(length(X), 1), [[] for i = 1:15]...]

    for i = 1:16
        #compute increment in Y
        dY = a[i, 1] * F[1];
        for j = 2:(i-1)
            if a[i, j] != 0
                dY = dY + a[i, j] * F[j];
            end
        end
        Y = X .+ dt * dY;
        F[i] = f(Y);
    end

    #increment in X
    dX = zeros(length(X), 1);
    for i = 1:16
        if b[i] != 0
            dX = dX + b[i] * F[i];
        end
    end

    Xnext = X .+ dt*dX;
end

function final_X(f, X0, tf, N, integrator=euler)
    X = X0
    dt = tf / (N-1)
    for i = 1:N-1
        X = integrator(f, X, dt)
    end
    X
end